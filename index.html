<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸­ç­è‹±æ–‡éŒ„éŸ³æŒ‘æˆ°</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --primary: #FF6B6B; --secondary: #4ECDC4; --bg: #F7FFF7; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 15px; text-align: center; -webkit-tap-highlight-color: transparent; }
        .header { background: white; padding: 15px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; position: sticky; top: 0; z-index: 100; }
        .lesson-nav { display: flex; overflow-x: auto; gap: 8px; padding: 10px 0; scrollbar-width: none; }
        .lesson-nav::-webkit-scrollbar { display: none; }
        .nav-btn { background: #f0f0f0; border: none; padding: 8px 18px; border-radius: 50px; white-space: nowrap; cursor: pointer; font-weight: bold; color: #666; font-size: 14px; }
        .nav-btn.active { background: var(--secondary); color: white; box-shadow: 0 4px 8px rgba(78,205,196,0.3); }
        .sentence-card { background: white; padding: 20px; border-radius: 20px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .english { font-size: 22px; color: #2D3436; font-weight: bold; display: block; margin-bottom: 8px; line-height: 1.3; }
        .btn-group { display: flex; justify-content: center; gap: 20px; margin-top: 10px; }
        .action-btn { border: none; width: 60px; height: 60px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 26px; transition: 0.1s; }
        .play-btn { background: #FFE66D; box-shadow: 0 4px 0 #E6CF62; }
        .rec-btn { background: #FF6B6B; color: white; box-shadow: 0 4px 0 #E55B5B; }
        .rec-btn.recording { animation: pulse 1s infinite; background: #ff0000; box-shadow: none; transform: translateY(4px); }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .footer-tips { font-size: 12px; color: #999; margin-top: 20px; }
        /* Line æé†’æ¨£å¼ */
        #line-notice { display: none; background: #FFF9C4; color: #856404; padding: 10px; margin-bottom: 15px; border-radius: 10px; font-size: 13px; line-height: 1.4; }
    </style>
</head>
<body>

<div class="header">
    <div id="line-notice">ğŸ’¡ åµæ¸¬åˆ°æ‚¨æ­£åœ¨ä½¿ç”¨ Line ç€è¦½å™¨ï¼ŒéŒ„éŸ³åŠŸèƒ½å¯èƒ½å—é™ã€‚è«‹é»æ“Šå³ä¸‹è§’ã€Œâ€¦ã€åœ–ç¤ºï¼Œä¸¦é¸æ“‡ã€Œä»¥é è¨­ç€è¦½å™¨é–‹å•Ÿã€æˆ–ã€Œä»¥ Safari é–‹å•Ÿã€ã€‚</div>
    <h2 style="margin:0 0 10px 0; color:var(--primary); font-size: 18px;">ğŸŒŸ è‹±èªå£èªªæŒ‘æˆ° (L1-L10)</h2>
    <div class="lesson-nav" id="lessonNav"></div>
</div>

<div id="content"></div>
<p class="footer-tips">é»æ“Š ğŸ”Š è½è€å¸«èªªï¼Œé»æ“Š ğŸ¤ éŒ„éŸ³æŒ‘æˆ°ï¼</p>

<script>
    const library = {
        "L1 é¡è‰²æ··å’Œ": [
            {e:"I mixed the red and blue. It made purple."},
            {e:"I mixed the red and yellow. It made orange."},
            {e:"I mixed the blue and yellow. It made green."}
        ],
        "L2 äº”æ„Ÿæ„Ÿå—": [
            {e:"It feels sharp."}, {e:"It tastes sweet."}, {e:"It sounds noisy."}, {e:"It looks funny."}, {e:"It smells like feet."}
        ],
        "L3 å½¢ç‹€èˆ‡æƒ³åƒ": [
            {e:"Thatâ€™s not just a triangle. Thatâ€™s a nose."}, {e:"Thatâ€™s not just a circle. Thatâ€™s a snowball."}, {e:"Thatâ€™s not just a rectangle. Thatâ€™s a scarf."}, {e:"Thatâ€™s not just a square. Thatâ€™s a hat."}
        ],
        "L4 ä½ å¹¾æ­²": [
            {e:"How old are you?"}, {e:"I am four."}, {e:"I am five."}, {e:"I am six."}
        ],
        "L5 ä¸Šå­¸äº¤é€š": [
            {e:"How do you go to school?"}, {e:"I go to school by bike."}, {e:"I go to school by scooter."}, {e:"I go to school by bus."}, {e:"I walk to school."}, {e:"I go to school by train."}, {e:"I go to school by car."}
        ],
        "L6 æˆ‘ä¸å–œæ­¡": [
            {e:"I donâ€™t like blue T-shirt."}, {e:"I donâ€™t like green peppers."}, {e:"I donâ€™t like red hats."}, {e:"I donâ€™t like orange tomatoes."}, {e:"I donâ€™t like yellow bees."}, {e:"David gets angry!"}
        ],
        "L7 å¤§è¡›å¹«å¿™": [
            {e:"I donâ€™t have any salt. David goes to get some salt."}, {e:"I donâ€™t have any apples. David goes to get some apples."}, {e:"I donâ€™t have any eggs. David goes to get a chicken."}, {e:"I donâ€™t have any milk. David goes to milk a cow."}
        ],
        "L8 è›‹ç³•åˆ†äº«": [
            {e:"Can dad have a cupcake?"}, {e:"Can brother and sister have cupcakes?"}, {e:"Can grandma and grandpa have cupcakes?"}
        ],
        "L9 åŒå­¸èˆˆè¶£": [
            {e:"Sara likes to play dress up."}, {e:"Matts likes to dance backward and upside down."}, {e:"Joy likes to sing all day."}, {e:"Paul likes to talk to animals and dress like a frog."}
        ],
        "L10 å¤§è¡›ä¸€é€±": [
            {e:"On Sunday David slept in a tree."}, {e:"On Monday David mixed red paint with his shampoo."}, {e:"On Tuesday David twisted Saraâ€™s hair with bubble gum."}, {e:"On Wednesday David washed Rusty with chocolate milk."}, {e:"On Thursday David tickled a frog."}, {e:"On Friday David made his bike fly."}
        ]
    };

    let mediaRecorder;
    let audioChunks = [];
    let currentLesson = Object.keys(library)[0];

    function init() {
        const nav = document.getElementById('lessonNav');
        // åµæ¸¬ Line
        if (/Line/i.test(navigator.userAgent)) {
            document.getElementById('line-notice').style.display = 'block';
        }

        Object.keys(library).forEach(lesson => {
            const btn = document.createElement('button');
            btn.className = `nav-btn ${lesson === currentLesson ? 'active' : ''}`;
            btn.innerText = lesson;
            btn.onclick = () => {
                currentLesson = lesson;
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                render();
            };
            nav.appendChild(btn);
        });
        render();
    }

    function render() {
        const container = document.getElementById('content');
        container.innerHTML = library[currentLesson].map((item, idx) => `
            <div class="sentence-card">
                <span class="english">${item.e}</span>
                <div class="btn-group">
                    <button class="action-btn play-btn" onclick="speak('${item.e.replace(/'/g, "\\'")}')">ğŸ”Š</button>
                    <button class="action-btn rec-btn" id="rec-${idx}" onclick="toggleRecord('${idx}')">ğŸ¤</button>
                </div>
            </div>
        `).join('');
    }

    function speak(text) {
        window.speechSynthesis.cancel(); // åœæ­¢ä¹‹å‰çš„æ’­æ”¾
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'en-US';
        msg.rate = 0.75;
        window.speechSynthesis.speak(msg);
    }

    async function toggleRecord(id) {
        const btn = document.getElementById(`rec-${id}`);
        
        if (mediaRecorder && mediaRecorder.state === "recording") {
            mediaRecorder.stop();
            btn.classList.remove('recording');
            btn.innerText = "ğŸ¤";
            return;
        }

        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            
            // é—œéµä¿®æ­£ï¼šiOS ä¸æ”¯æ´ wavï¼Œéœ€å‹•æ…‹åˆ¤æ–·æ ¼å¼
            let mimeType = 'audio/webm';
            if (!MediaRecorder.isTypeSupported(mimeType)) {
                mimeType = 'audio/mp4'; 
            }

            mediaRecorder = new MediaRecorder(stream, { mimeType });
            audioChunks = [];

            mediaRecorder.ondataavailable = (e) => {
                if (e.data.size > 0) audioChunks.push(e.data);
            };

            mediaRecorder.onstop = () => {
                const blob = new Blob(audioChunks, { type: mimeType });
                const url = URL.createObjectURL(blob);
                const audio = new Audio(url);
                
                // é‡å° iOS å„ªåŒ–æ’­æ”¾
                audio.play().catch(e => console.log("iOS æ’­æ”¾è¢«æ””æˆª:", e));

                // éŒ„éŸ³å®Œç•¢ç«‹å³é‡‹æ”¾éº¥å…‹é¢¨ï¼Œè§£æ±º iOS ä½”ç”¨å•é¡Œ
                stream.getTracks().forEach(track => track.stop());
            };

            mediaRecorder.start();
            btn.classList.add('recording');
            btn.innerText = "â¹ï¸";

        } catch (err) {
            console.error(err);
            if (/Line/i.test(navigator.userAgent)) {
                alert("Line ç€è¦½å™¨é™åˆ¶éŒ„éŸ³ï¼Œè«‹é»é¸å³ä¸‹è§’ä¸¦æ”¹ç”¨ Safari é–‹å•Ÿï¼");
            } else {
                alert("éŒ„éŸ³å¤±æ•—ï¼šè«‹ç¢ºèªé–‹å•Ÿéº¥å…‹é¢¨æ¬Šé™ä¸”ç¶²å€ç‚º HTTPSã€‚");
            }
        }
    }

    window.onload = init;
</script>
</body>
</html>
